<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LearnHub Pro - Advanced Learning Management System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        .progress-bar {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
        }
    </style>
</head>
<body class="gradient-bg min-h-full">
    <!-- Navigation -->
    <nav class="glass-effect shadow-xl">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl flex items-center justify-center shadow-lg">
                        <span class="text-white font-bold text-xl">L</span>
                    </div>
                    <h1 class="text-2xl font-bold text-white">LearnHub Pro</h1>
                </div>
                <div id="navButtons" class="flex space-x-4">
                    <button onclick="showLogin()" class="bg-white bg-opacity-20 text-white px-6 py-2 rounded-xl hover:bg-opacity-30 transition-all duration-300 backdrop-blur-sm border border-white border-opacity-30">Login</button>
                    <button onclick="showRegister()" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-2 rounded-xl hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg">Register</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Notification Area -->
    <div id="notifications" class="fixed top-20 right-4 z-50 space-y-2"></div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 py-8">
        <!-- Welcome Screen -->
        <div id="welcomeScreen" class="text-center py-16">
            <h2 class="text-5xl font-bold text-white mb-6 drop-shadow-lg">Welcome to LearnHub Pro</h2>
            <p class="text-xl text-white text-opacity-90 mb-12 drop-shadow">Your advanced learning management ecosystem</p>
            <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
                <div class="glass-effect p-8 rounded-2xl shadow-2xl card-hover">
                    <div class="w-16 h-16 bg-gradient-to-r from-blue-500 to-cyan-500 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <span class="text-white text-2xl">üéì</span>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-6">For Students</h3>
                    <ul class="text-left space-y-3 text-white text-opacity-90">
                        <li class="flex items-center"><span class="w-2 h-2 bg-blue-400 rounded-full mr-3"></span>Enroll in premium courses</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-blue-400 rounded-full mr-3"></span>Submit multimedia assignments</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-blue-400 rounded-full mr-3"></span>Track grades & performance</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-blue-400 rounded-full mr-3"></span>Interactive learning dashboard</li>
                    </ul>
                </div>
                <div class="glass-effect p-8 rounded-2xl shadow-2xl card-hover">
                    <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <span class="text-white text-2xl">üë®‚Äçüè´</span>
                    </div>
                    <h3 class="text-2xl font-bold text-white mb-6">For Teachers</h3>
                    <ul class="text-left space-y-3 text-white text-opacity-90">
                        <li class="flex items-center"><span class="w-2 h-2 bg-purple-400 rounded-full mr-3"></span>Create engaging courses</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-purple-400 rounded-full mr-3"></span>Advanced assignment tools</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-purple-400 rounded-full mr-3"></span>Smart grading system</li>
                        <li class="flex items-center"><span class="w-2 h-2 bg-purple-400 rounded-full mr-3"></span>Student analytics dashboard</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Login Form -->
        <div id="loginForm" class="hidden max-w-md mx-auto glass-effect rounded-2xl shadow-2xl p-8">
            <h2 class="text-3xl font-bold text-center text-white mb-8">Welcome Back</h2>
            <form onsubmit="handleLogin(event)">
                <div class="mb-6">
                    <label class="block text-white text-sm font-semibold mb-3">Email Address</label>
                    <input type="email" id="loginEmail" required class="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-white placeholder-white placeholder-opacity-70" placeholder="Enter your email">
                </div>
                <div class="mb-8">
                    <label class="block text-white text-sm font-semibold mb-3">Password</label>
                    <input type="password" id="loginPassword" required class="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-white placeholder-white placeholder-opacity-70" placeholder="Enter your password">
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 rounded-xl hover:from-purple-700 hover:to-blue-700 transition-all duration-300 font-semibold shadow-lg">Sign In</button>
            </form>
            <p class="text-center mt-6 text-white text-opacity-90">
                Don't have an account? 
                <button onclick="showRegister()" class="text-pink-300 hover:text-pink-200 font-semibold hover:underline">Register here</button>
            </p>
        </div>

        <!-- Registration Form -->
        <div id="registerForm" class="hidden max-w-md mx-auto glass-effect rounded-2xl shadow-2xl p-8">
            <h2 class="text-3xl font-bold text-center text-white mb-8">Join LearnHub Pro</h2>
            <form onsubmit="handleRegister(event)">
                <div class="mb-5">
                    <label class="block text-white text-sm font-semibold mb-3">Full Name</label>
                    <input type="text" id="registerName" required class="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-white placeholder-white placeholder-opacity-70" placeholder="Enter your full name">
                </div>
                <div class="mb-5">
                    <label class="block text-white text-sm font-semibold mb-3">Email Address</label>
                    <input type="email" id="registerEmail" required class="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-white placeholder-white placeholder-opacity-70" placeholder="Enter your email">
                </div>
                <div class="mb-5">
                    <label class="block text-white text-sm font-semibold mb-3">Password</label>
                    <input type="password" id="registerPassword" required class="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-white placeholder-white placeholder-opacity-70" placeholder="Create a password">
                </div>
                <div class="mb-8">
                    <label class="block text-white text-sm font-semibold mb-3">I am a</label>
                    <select id="registerRole" required class="w-full px-4 py-3 bg-white bg-opacity-20 border border-white border-opacity-30 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-400 text-white">
                        <option value="" class="text-gray-800">Select your role</option>
                        <option value="student" class="text-gray-800">Student</option>
                        <option value="teacher" class="text-gray-800">Teacher</option>
                    </select>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-pink-500 to-purple-600 text-white py-3 rounded-xl hover:from-pink-600 hover:to-purple-700 transition-all duration-300 font-semibold shadow-lg">Create Account</button>
            </form>
            <p class="text-center mt-6 text-white text-opacity-90">
                Already have an account? 
                <button onclick="showLogin()" class="text-blue-300 hover:text-blue-200 font-semibold hover:underline">Login here</button>
            </p>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="hidden">
            <!-- Dashboard Header -->
            <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800" id="dashboardTitle">Dashboard</h2>
                        <p class="text-gray-600" id="userWelcome">Welcome back!</p>
                    </div>
                    <button onclick="logout()" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">Logout</button>
                </div>
            </div>

            <!-- Teacher Dashboard -->
            <div id="teacherDashboard" class="hidden space-y-8">
                <!-- Course Creation -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">Create New Course</h3>
                    <form onsubmit="createCourse(event)" class="grid md:grid-cols-3 gap-4">
                        <input type="text" id="courseTitle" placeholder="Course Title" required class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                        <input type="text" id="courseDuration" placeholder="Duration (e.g., 8 weeks)" required class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                        <button type="submit" class="bg-indigo-600 text-white py-2 rounded-lg hover:bg-indigo-700 transition-colors">Create Course</button>
                        <textarea id="courseDescription" placeholder="Course Description" required class="md:col-span-3 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 h-24"></textarea>
                    </form>
                </div>

                <!-- My Courses -->
                <div class="bg-white rounded-xl shadow-lg p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">My Courses</h3>
                    <div id="teacherCourses" class="space-y-4"></div>
                </div>
            </div>

            <!-- Student Dashboard -->
            <div id="studentDashboard" class="hidden space-y-8">
                <!-- Student Performance Dashboard -->
                <div class="glass-effect rounded-2xl shadow-2xl p-6">
                    <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                        <span class="mr-3">üìä</span>My Performance Dashboard
                    </h3>
                    <div id="studentStats" class="grid md:grid-cols-4 gap-4 mb-6"></div>
                    <div id="gradeChart" class="bg-white bg-opacity-10 rounded-xl p-4"></div>
                </div>

                <!-- Available Courses -->
                <div class="glass-effect rounded-2xl shadow-2xl p-6">
                    <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                        <span class="mr-3">üéØ</span>Available Courses
                    </h3>
                    <div id="availableCourses" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                </div>

                <!-- My Enrolled Courses -->
                <div class="glass-effect rounded-2xl shadow-2xl p-6">
                    <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                        <span class="mr-3">üìö</span>My Enrolled Courses
                    </h3>
                    <div id="enrolledCourses" class="space-y-4"></div>
                </div>
            </div>
        </div>

        <!-- Course Detail Modal -->
        <div id="courseModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40">
            <div class="bg-white rounded-xl shadow-2xl max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
                <div class="p-6 border-b">
                    <div class="flex justify-between items-center">
                        <h2 id="modalCourseTitle" class="text-2xl font-bold text-gray-800"></h2>
                        <button onclick="closeCourseModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                    </div>
                </div>
                <div class="p-6">
                    <div id="courseContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Storage - Enhanced Database Structure
        let users = JSON.parse(localStorage.getItem('lms_users') || '[]');
        let courses = JSON.parse(localStorage.getItem('lms_courses') || '[]');
        let enrollments = JSON.parse(localStorage.getItem('lms_enrollments') || '[]');
        let assignments = JSON.parse(localStorage.getItem('lms_assignments') || '[]');
        let submissions = JSON.parse(localStorage.getItem('lms_submissions') || '[]');
        let grades = JSON.parse(localStorage.getItem('lms_grades') || '[]');
        let courseMaterials = JSON.parse(localStorage.getItem('lms_courseMaterials') || '[]'); // New: Course files/videos
        let currentUser = JSON.parse(localStorage.getItem('lms_currentUser') || 'null');

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            if (currentUser) {
                showDashboard();
            }
        });

        // Utility Functions
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification px-6 py-3 rounded-lg text-white ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
            notification.textContent = message;
            document.getElementById('notifications').appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function saveData() {
            localStorage.setItem('lms_users', JSON.stringify(users));
            localStorage.setItem('lms_courses', JSON.stringify(courses));
            localStorage.setItem('lms_enrollments', JSON.stringify(enrollments));
            localStorage.setItem('lms_assignments', JSON.stringify(assignments));
            localStorage.setItem('lms_submissions', JSON.stringify(submissions));
            localStorage.setItem('lms_grades', JSON.stringify(grades));
            localStorage.setItem('lms_courseMaterials', JSON.stringify(courseMaterials));
            localStorage.setItem('lms_currentUser', JSON.stringify(currentUser));
        }

        // Navigation Functions
        function showLogin() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('loginForm').classList.add('fade-in');
        }

        function showRegister() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('registerForm').classList.remove('hidden');
            document.getElementById('registerForm').classList.add('fade-in');
        }

        function showDashboard() {
            document.getElementById('welcomeScreen').classList.add('hidden');
            document.getElementById('loginForm').classList.add('hidden');
            document.getElementById('registerForm').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('fade-in');

            // Update navigation
            document.getElementById('navButtons').innerHTML = `
                <span class="text-white text-opacity-90 font-medium">Welcome, ${currentUser.name}</span>
                <button onclick="logout()" class="bg-gradient-to-r from-red-500 to-pink-600 text-white px-4 py-2 rounded-xl hover:from-red-600 hover:to-pink-700 transition-all duration-300 shadow-lg">Logout</button>
            `;

            // Update dashboard content
            document.getElementById('userWelcome').textContent = `Welcome back, ${currentUser.name}!`;
            
            if (currentUser.role === 'teacher') {
                document.getElementById('teacherDashboard').classList.remove('hidden');
                document.getElementById('studentDashboard').classList.add('hidden');
                loadTeacherCourses();
            } else {
                document.getElementById('studentDashboard').classList.remove('hidden');
                document.getElementById('teacherDashboard').classList.add('hidden');
                loadStudentStats();
                loadAvailableCourses();
                loadEnrolledCourses();
            }
        }

        // Authentication Functions
        function handleRegister(event) {
            event.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const role = document.getElementById('registerRole').value;

            // Check if user already exists
            if (users.find(user => user.email === email)) {
                showNotification('User with this email already exists!', 'error');
                return;
            }

            // Create new user
            const newUser = {
                id: generateId(),
                name,
                email,
                password, // In real app, this would be hashed
                role,
                createdAt: new Date().toISOString()
            };

            users.push(newUser);
            saveData();
            
            showNotification('Registration successful! Please login.');
            showLogin();
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                saveData();
                showNotification(`Welcome back, ${user.name}!`);
                showDashboard();
            } else {
                showNotification('Invalid email or password!', 'error');
            }
        }

        function logout() {
            currentUser = null;
            saveData();
            
            // Reset navigation
            document.getElementById('navButtons').innerHTML = `
                <button onclick="showLogin()" class="bg-white bg-opacity-20 text-white px-6 py-2 rounded-xl hover:bg-opacity-30 transition-all duration-300 backdrop-blur-sm border border-white border-opacity-30">Login</button>
                <button onclick="showRegister()" class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-6 py-2 rounded-xl hover:from-pink-600 hover:to-purple-700 transition-all duration-300 shadow-lg">Register</button>
            `;
            
            document.getElementById('welcomeScreen').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            showNotification('Logged out successfully!');
        }

        // Course Management Functions
        function createCourse(event) {
            event.preventDefault();
            
            const title = document.getElementById('courseTitle').value;
            const description = document.getElementById('courseDescription').value;
            const duration = document.getElementById('courseDuration').value;

            const newCourse = {
                id: generateId(),
                title,
                description,
                duration,
                teacherId: currentUser.id,
                teacherName: currentUser.name,
                createdAt: new Date().toISOString(),
                students: []
            };

            courses.push(newCourse);
            saveData();
            
            showNotification('Course created successfully!');
            document.getElementById('courseTitle').value = '';
            document.getElementById('courseDescription').value = '';
            document.getElementById('courseDuration').value = '';
            
            loadTeacherCourses();
        }

        function loadTeacherCourses() {
            const teacherCourses = courses.filter(course => course.teacherId === currentUser.id);
            const container = document.getElementById('teacherCourses');
            
            if (teacherCourses.length === 0) {
                container.innerHTML = '<p class="text-gray-500">No courses created yet.</p>';
                return;
            }

            container.innerHTML = teacherCourses.map(course => {
                const enrolledStudents = enrollments.filter(e => e.courseId === course.id);
                return `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-bold text-lg text-gray-800">${course.title}</h4>
                                <p class="text-gray-600 mb-2">${course.description}</p>
                                <p class="text-sm text-gray-500">Duration: ${course.duration}</p>
                                <p class="text-sm text-gray-500">Students enrolled: ${enrolledStudents.length}</p>
                            </div>
                            <button onclick="manageCourse('${course.id}')" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">
                                Manage
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAvailableCourses() {
            const container = document.getElementById('availableCourses');
            
            if (courses.length === 0) {
                container.innerHTML = '<p class="text-gray-500 col-span-full text-center">No courses available yet.</p>';
                return;
            }

            container.innerHTML = courses.map(course => {
                const isEnrolled = enrollments.some(e => e.studentId === currentUser.id && e.courseId === course.id);
                return `
                    <div class="border border-gray-200 rounded-lg p-4">
                        <h4 class="font-bold text-lg text-gray-800 mb-2">${course.title}</h4>
                        <p class="text-gray-600 text-sm mb-2">${course.description}</p>
                        <p class="text-gray-500 text-xs mb-3">Duration: ${course.duration}</p>
                        <p class="text-gray-500 text-xs mb-3">Instructor: ${course.teacherName}</p>
                        ${isEnrolled ? 
                            '<button class="w-full bg-gray-400 text-white py-2 rounded-lg cursor-not-allowed">Already Enrolled</button>' :
                            `<button onclick="enrollInCourse('${course.id}')" class="w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700 transition-colors">Enroll</button>`
                        }
                    </div>
                `;
            }).join('');
        }

        function loadEnrolledCourses() {
            const studentEnrollments = enrollments.filter(e => e.studentId === currentUser.id);
            const enrolledCourses = studentEnrollments.map(e => courses.find(c => c.id === e.courseId)).filter(Boolean);
            const container = document.getElementById('enrolledCourses');
            
            if (enrolledCourses.length === 0) {
                container.innerHTML = '<p class="text-white text-opacity-70">You are not enrolled in any courses yet.</p>';
                return;
            }

            container.innerHTML = enrolledCourses.map(course => {
                const courseAssignments = assignments.filter(a => a.courseId === course.id);
                const myGrades = grades.filter(g => g.studentId === currentUser.id && courseAssignments.some(a => a.id === g.assignmentId));
                const averageGrade = myGrades.length > 0 ? (myGrades.reduce((sum, grade) => sum + grade.score, 0) / myGrades.length).toFixed(1) : 'N/A';
                
                return `
                    <div class="bg-white bg-opacity-10 border border-white border-opacity-20 rounded-xl p-6 card-hover">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-bold text-xl text-white mb-2">${course.title}</h4>
                                <p class="text-white text-opacity-80 mb-3">${course.description}</p>
                                <div class="flex items-center space-x-4 text-sm text-white text-opacity-70">
                                    <span>üë®‚Äçüè´ ${course.teacherName}</span>
                                    <span>üìù ${courseAssignments.length} assignments</span>
                                    <span class="font-semibold ${averageGrade !== 'N/A' && averageGrade >= 70 ? 'text-green-300' : averageGrade !== 'N/A' && averageGrade >= 50 ? 'text-yellow-300' : 'text-red-300'}">
                                        üìä ${averageGrade}${averageGrade !== 'N/A' ? '/100' : ''}
                                    </span>
                                </div>
                            </div>
                            <button onclick="viewCourse('${course.id}')" class="bg-gradient-to-r from-blue-500 to-purple-600 text-white px-6 py-3 rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-300 font-semibold shadow-lg">
                                View Course
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadStudentStats() {
            const studentEnrollments = enrollments.filter(e => e.studentId === currentUser.id);
            const enrolledCourses = studentEnrollments.map(e => courses.find(c => c.id === e.courseId)).filter(Boolean);
            const allCourseAssignments = enrolledCourses.flatMap(course => assignments.filter(a => a.courseId === course.id));
            const myGrades = grades.filter(g => g.studentId === currentUser.id && allCourseAssignments.some(a => a.id === g.assignmentId));
            const mySubmissions = submissions.filter(s => s.studentId === currentUser.id);
            
            const totalAssignments = allCourseAssignments.length;
            const completedAssignments = mySubmissions.length;
            const averageGrade = myGrades.length > 0 ? (myGrades.reduce((sum, grade) => sum + grade.score, 0) / myGrades.length).toFixed(1) : 0;
            const completionRate = totalAssignments > 0 ? ((completedAssignments / totalAssignments) * 100).toFixed(1) : 0;

            document.getElementById('studentStats').innerHTML = `
                <div class="bg-white bg-opacity-10 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-white">${enrolledCourses.length}</div>
                    <div class="text-white text-opacity-70 text-sm">Enrolled Courses</div>
                </div>
                <div class="bg-white bg-opacity-10 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-white">${completedAssignments}/${totalAssignments}</div>
                    <div class="text-white text-opacity-70 text-sm">Assignments Done</div>
                </div>
                <div class="bg-white bg-opacity-10 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold ${averageGrade >= 70 ? 'text-green-300' : averageGrade >= 50 ? 'text-yellow-300' : 'text-red-300'}">${averageGrade}/100</div>
                    <div class="text-white text-opacity-70 text-sm">Average Grade</div>
                </div>
                <div class="bg-white bg-opacity-10 rounded-xl p-4 text-center">
                    <div class="text-2xl font-bold text-white">${completionRate}%</div>
                    <div class="text-white text-opacity-70 text-sm">Completion Rate</div>
                </div>
            `;

            // Grade Chart
            if (myGrades.length > 0) {
                const gradeDistribution = {
                    'A (90-100)': myGrades.filter(g => g.score >= 90).length,
                    'B (80-89)': myGrades.filter(g => g.score >= 80 && g.score < 90).length,
                    'C (70-79)': myGrades.filter(g => g.score >= 70 && g.score < 80).length,
                    'D (60-69)': myGrades.filter(g => g.score >= 60 && g.score < 70).length,
                    'F (0-59)': myGrades.filter(g => g.score < 60).length
                };

                document.getElementById('gradeChart').innerHTML = `
                    <h4 class="text-white font-semibold mb-4">Grade Distribution</h4>
                    <div class="space-y-3">
                        ${Object.entries(gradeDistribution).map(([grade, count]) => `
                            <div class="flex items-center justify-between">
                                <span class="text-white text-opacity-80">${grade}</span>
                                <div class="flex items-center space-x-2">
                                    <div class="w-32 bg-white bg-opacity-20 rounded-full h-2">
                                        <div class="progress-bar h-2 rounded-full" style="width: ${myGrades.length > 0 ? (count / myGrades.length) * 100 : 0}%"></div>
                                    </div>
                                    <span class="text-white font-semibold w-8">${count}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                document.getElementById('gradeChart').innerHTML = `
                    <div class="text-center text-white text-opacity-70 py-8">
                        <div class="text-4xl mb-4">üìà</div>
                        <p>No grades available yet. Complete some assignments to see your performance!</p>
                    </div>
                `;
            }
        }

        // Enrollment Functions
        function enrollInCourse(courseId) {
            const enrollment = {
                id: generateId(),
                studentId: currentUser.id,
                courseId: courseId,
                enrolledAt: new Date().toISOString()
            };

            enrollments.push(enrollment);
            saveData();
            
            showNotification('Successfully enrolled in course!');
            loadAvailableCourses();
            loadEnrolledCourses();
        }

        // Course Management Modal
        function manageCourse(courseId) {
            const course = courses.find(c => c.id === courseId);
            const courseEnrollments = enrollments.filter(e => e.courseId === courseId);
            const courseStudents = courseEnrollments.map(e => users.find(u => u.id === e.studentId)).filter(Boolean);
            const courseAssignments = assignments.filter(a => a.courseId === courseId);

            document.getElementById('modalCourseTitle').textContent = `Manage: ${course.title}`;
            document.getElementById('courseContent').innerHTML = `
                <div class="space-y-6">
                    <!-- Course Info -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-2">Course Information</h3>
                        <p><strong>Description:</strong> ${course.description}</p>
                        <p><strong>Duration:</strong> ${course.duration}</p>
                        <p><strong>Students Enrolled:</strong> ${courseStudents.length}</p>
                    </div>

                    <!-- Upload Course Materials -->
                    <div class="bg-white border border-gray-200 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">üìÅ Upload Course Materials</h3>
                        <form onsubmit="uploadCourseMaterial(event, '${courseId}')" class="space-y-4">
                            <input type="text" id="materialTitle" placeholder="Material Title (e.g., Lecture 1 Notes)" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                            <textarea id="materialDescription" placeholder="Material Description" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 h-20"></textarea>
                            <select id="materialType" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                                <option value="">Select Material Type</option>
                                <option value="document">üìÑ Document (PDF, DOC, PPT)</option>
                                <option value="video">üé• Video Lecture</option>
                                <option value="audio">üéµ Audio File</option>
                                <option value="image">üñºÔ∏è Image/Diagram</option>
                                <option value="other">üìé Other File</option>
                            </select>
                            <input type="file" id="materialFile" accept="*/*" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                            <button type="submit" class="bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-2 rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-300 font-semibold shadow-lg">üì§ Upload Material</button>
                        </form>
                    </div>

                    <!-- Course Materials List -->
                    <div class="bg-white border border-gray-200 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">üìö Course Materials</h3>
                        <div id="courseMaterialsList">
                            ${(() => {
                                const materials = courseMaterials.filter(m => m.courseId === courseId);
                                if (materials.length === 0) {
                                    return '<p class="text-gray-500">No materials uploaded yet.</p>';
                                }
                                return materials.map(material => `
                                    <div class="border border-gray-200 rounded-lg p-4 mb-3 flex justify-between items-start">
                                        <div class="flex-1">
                                            <h4 class="font-bold text-gray-800">${material.title}</h4>
                                            <p class="text-gray-600 text-sm mb-1">${material.description || 'No description'}</p>
                                            <div class="flex items-center space-x-4 text-xs text-gray-500">
                                                <span>${material.type === 'document' ? 'üìÑ' : material.type === 'video' ? 'üé•' : material.type === 'audio' ? 'üéµ' : material.type === 'image' ? 'üñºÔ∏è' : 'üìé'} ${material.fileName}</span>
                                                <span>üìè ${material.fileSize}</span>
                                                <span>üìÖ ${new Date(material.uploadedAt).toLocaleDateString()}</span>
                                            </div>
                                        </div>
                                        <button onclick="deleteMaterial('${material.id}', '${courseId}')" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors ml-4">üóëÔ∏è Delete</button>
                                    </div>
                                `).join('');
                            })()}
                        </div>
                    </div>

                    <!-- Create Assignment -->
                    <div class="bg-white border border-gray-200 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">üìù Create Assignment</h3>
                        <form onsubmit="createAssignment(event, '${courseId}')" class="space-y-4">
                            <input type="text" id="assignmentTitle" placeholder="Assignment Title" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                            <textarea id="assignmentDescription" placeholder="Assignment Description" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 h-24"></textarea>
                            <input type="date" id="assignmentDueDate" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500">
                            <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Create Assignment</button>
                        </form>
                    </div>

                    <!-- Assignments List -->
                    <div class="bg-white border border-gray-200 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">Course Assignments</h3>
                        <div id="assignmentsList">
                            ${courseAssignments.length === 0 ? 
                                '<p class="text-gray-500">No assignments created yet.</p>' :
                                courseAssignments.map(assignment => {
                                    const assignmentSubmissions = submissions.filter(s => s.assignmentId === assignment.id);
                                    const gradedSubmissions = assignmentSubmissions.filter(s => grades.some(g => g.assignmentId === assignment.id && g.studentId === s.studentId));
                                    const pendingSubmissions = assignmentSubmissions.length - gradedSubmissions.length;
                                    
                                    return `
                                        <div class="border border-gray-200 rounded-lg p-4 mb-4">
                                            <div class="flex justify-between items-start mb-3">
                                                <div class="flex-1">
                                                    <h4 class="font-bold text-lg">${assignment.title}</h4>
                                                    <p class="text-gray-600 text-sm mb-2">${assignment.description}</p>
                                                    <p class="text-gray-500 text-xs">üìÖ Due: ${new Date(assignment.dueDate).toLocaleDateString()}</p>
                                                </div>
                                                <div class="text-right">
                                                    <div class="text-sm font-semibold text-gray-700">üìä Submissions: ${assignmentSubmissions.length}</div>
                                                    <div class="text-xs text-green-600">‚úÖ Graded: ${gradedSubmissions.length}</div>
                                                    <div class="text-xs text-orange-600">‚è≥ Pending: ${pendingSubmissions}</div>
                                                </div>
                                            </div>
                                            <div class="flex space-x-2">
                                                <button onclick="viewSubmissions('${assignment.id}')" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-lg text-sm hover:from-green-600 hover:to-emerald-700 transition-all duration-300 font-semibold shadow-lg">
                                                    üìã View All Submissions
                                                </button>
                                                ${pendingSubmissions > 0 ? 
                                                    `<button onclick="viewPendingSubmissions('${assignment.id}')" class="bg-gradient-to-r from-orange-500 to-red-500 text-white px-4 py-2 rounded-lg text-sm hover:from-orange-600 hover:to-red-600 transition-all duration-300 font-semibold shadow-lg">
                                                        ‚ö†Ô∏è Grade Pending (${pendingSubmissions})
                                                    </button>` : ''
                                                }
                                            </div>
                                        </div>
                                    `;
                                }).join('')
                            }
                        </div>
                    </div>

                    <!-- Enrolled Students -->
                    <div class="bg-white border border-gray-200 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">Enrolled Students</h3>
                        ${courseStudents.length === 0 ? 
                            '<p class="text-gray-500">No students enrolled yet.</p>' :
                            courseStudents.map(student => `
                                <div class="flex justify-between items-center py-2 border-b border-gray-100 last:border-b-0">
                                    <div>
                                        <p class="font-medium">${student.name}</p>
                                        <p class="text-sm text-gray-500">${student.email}</p>
                                    </div>
                                    <button onclick="viewStudentGrades('${student.id}', '${courseId}')" class="bg-indigo-600 text-white px-3 py-1 rounded text-sm hover:bg-indigo-700 transition-colors">
                                        View Grades
                                    </button>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
            `;
            document.getElementById('courseModal').classList.remove('hidden');
        }

        function viewCourse(courseId) {
            const course = courses.find(c => c.id === courseId);
            const courseAssignments = assignments.filter(a => a.courseId === courseId);

            document.getElementById('modalCourseTitle').textContent = course.title;
            document.getElementById('courseContent').innerHTML = `
                <div class="space-y-6">
                    <!-- Course Info -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-2">Course Information</h3>
                        <p><strong>Description:</strong> ${course.description}</p>
                        <p><strong>Duration:</strong> ${course.duration}</p>
                        <p><strong>Instructor:</strong> ${course.teacherName}</p>
                    </div>

                    <!-- Course Materials -->
                    <div class="bg-white border border-gray-200 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">üìö Course Materials</h3>
                        ${(() => {
                            const materials = courseMaterials.filter(m => m.courseId === courseId);
                            if (materials.length === 0) {
                                return '<p class="text-gray-500">No materials available yet.</p>';
                            }
                            return `
                                <div class="grid md:grid-cols-2 gap-4">
                                    ${materials.map(material => `
                                        <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                            <div class="flex items-start space-x-3">
                                                <div class="text-2xl">
                                                    ${material.type === 'document' ? 'üìÑ' : material.type === 'video' ? 'üé•' : material.type === 'audio' ? 'üéµ' : material.type === 'image' ? 'üñºÔ∏è' : 'üìé'}
                                                </div>
                                                <div class="flex-1">
                                                    <h4 class="font-bold text-gray-800 mb-1">${material.title}</h4>
                                                    <p class="text-gray-600 text-sm mb-2">${material.description || 'No description'}</p>
                                                    <div class="flex items-center space-x-3 text-xs text-gray-500">
                                                        <span>üìÅ ${material.fileName}</span>
                                                        <span>üìè ${material.fileSize}</span>
                                                    </div>
                                                    <div class="mt-2">
                                                        <button onclick="downloadMaterial('${material.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-xs hover:bg-blue-600 transition-colors">
                                                            üì• Download
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            `;
                        })()}
                    </div>

                    <!-- Assignments -->
                    <div class="bg-white border border-gray-200 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">Assignments</h3>
                        ${courseAssignments.length === 0 ? 
                            '<p class="text-gray-500">No assignments available yet.</p>' :
                            courseAssignments.map(assignment => {
                                const mySubmission = submissions.find(s => s.assignmentId === assignment.id && s.studentId === currentUser.id);
                                const myGrade = grades.find(g => g.assignmentId === assignment.id && g.studentId === currentUser.id);
                                
                                return `
                                    <div class="border border-gray-200 rounded-lg p-4 mb-4">
                                        <h4 class="font-bold">${assignment.title}</h4>
                                        <p class="text-gray-600 text-sm mb-2">${assignment.description}</p>
                                        <p class="text-gray-500 text-xs mb-3">Due: ${new Date(assignment.dueDate).toLocaleDateString()}</p>
                                        
                                        ${mySubmission ? 
                                            `<div class="bg-green-50 p-3 rounded mb-3">
                                                <p class="text-green-800 text-sm font-medium">‚úì Submitted</p>
                                                <p class="text-green-600 text-xs">Submitted on: ${new Date(mySubmission.submittedAt).toLocaleDateString()}</p>
                                                ${myGrade ? 
                                                    `<p class="text-green-600 text-sm mt-1">Grade: ${myGrade.score}/100 - ${myGrade.feedback || 'No feedback'}</p>` : 
                                                    '<p class="text-yellow-600 text-sm mt-1">Pending grading</p>'
                                                }
                                            </div>` :
                                            `<form onsubmit="submitAssignment(event, '${assignment.id}')" class="space-y-4">
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">Written Submission</label>
                                                    <textarea placeholder="Type your submission here..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 h-24" name="submission"></textarea>
                                                </div>
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700 mb-2">File Upload (Optional)</label>
                                                    <input type="file" name="assignmentFile" accept="*/*" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100">
                                                    <p class="text-xs text-gray-500 mt-1">Supports all file types: PDF, DOC, PPT, images, videos, etc.</p>
                                                </div>
                                                <button type="submit" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-2 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 font-semibold shadow-lg">Submit Assignment</button>
                                            </form>`
                                        }
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>

                    <!-- My Grades -->
                    <div class="bg-white border border-gray-200 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-4">My Grades</h3>
                        ${(() => {
                            const myGrades = grades.filter(g => g.studentId === currentUser.id && courseAssignments.some(a => a.id === g.assignmentId));
                            if (myGrades.length === 0) {
                                return '<p class="text-gray-500">No grades available yet.</p>';
                            }
                            
                            const totalScore = myGrades.reduce((sum, grade) => sum + grade.score, 0);
                            const averageScore = totalScore / myGrades.length;
                            
                            return `
                                <div class="mb-4 p-3 bg-indigo-50 rounded-lg">
                                    <p class="text-lg font-bold text-indigo-800">Overall Average: ${averageScore.toFixed(1)}/100</p>
                                </div>
                                ${myGrades.map(grade => {
                                    const assignment = courseAssignments.find(a => a.id === grade.assignmentId);
                                    return `
                                        <div class="border-b border-gray-100 py-2 last:border-b-0">
                                            <div class="flex justify-between items-center">
                                                <span class="font-medium">${assignment.title}</span>
                                                <span class="text-lg font-bold ${grade.score >= 70 ? 'text-green-600' : grade.score >= 50 ? 'text-yellow-600' : 'text-red-600'}">${grade.score}/100</span>
                                            </div>
                                            ${grade.feedback ? `<p class="text-sm text-gray-600 mt-1">${grade.feedback}</p>` : ''}
                                        </div>
                                    `;
                                }).join('')}
                            `;
                        })()}
                    </div>
                </div>
            `;
            document.getElementById('courseModal').classList.remove('hidden');
        }

        function closeCourseModal() {
            document.getElementById('courseModal').classList.add('hidden');
        }

        // Assignment Functions
        function createAssignment(event, courseId) {
            event.preventDefault();
            
            const title = document.getElementById('assignmentTitle').value;
            const description = document.getElementById('assignmentDescription').value;
            const dueDate = document.getElementById('assignmentDueDate').value;

            const newAssignment = {
                id: generateId(),
                courseId,
                title,
                description,
                dueDate,
                createdAt: new Date().toISOString()
            };

            assignments.push(newAssignment);
            saveData();
            
            showNotification('Assignment created successfully!');
            manageCourse(courseId); // Refresh the modal
        }

        function submitAssignment(event, assignmentId) {
            event.preventDefault();
            
            const submissionText = event.target.submission.value;
            const fileInput = event.target.assignmentFile;
            let fileName = null;
            let fileSize = null;
            let fileType = null;

            // Handle file upload
            if (fileInput && fileInput.files.length > 0) {
                const file = fileInput.files[0];
                fileName = file.name;
                fileSize = (file.size / 1024 / 1024).toFixed(2) + ' MB'; // Convert to MB
                fileType = file.type || 'Unknown';
                
                // In a real application, you would upload the file to a server
                // For this demo, we'll just store the file information
            }

            const newSubmission = {
                id: generateId(),
                assignmentId,
                studentId: currentUser.id,
                content: submissionText,
                fileName: fileName,
                fileSize: fileSize,
                fileType: fileType,
                submittedAt: new Date().toISOString()
            };

            submissions.push(newSubmission);
            saveData();
            
            if (fileName) {
                showNotification(`Assignment submitted with file: ${fileName}!`);
            } else {
                showNotification('Assignment submitted successfully!');
            }
            
            // Refresh the course view
            const assignment = assignments.find(a => a.id === assignmentId);
            viewCourse(assignment.courseId);
        }

        function viewSubmissions(assignmentId) {
            const assignment = assignments.find(a => a.id === assignmentId);
            const assignmentSubmissions = submissions.filter(s => s.assignmentId === assignmentId);
            
            document.getElementById('modalCourseTitle').textContent = `Submissions: ${assignment.title}`;
            document.getElementById('courseContent').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-2">Assignment Details</h3>
                        <p><strong>Title:</strong> ${assignment.title}</p>
                        <p><strong>Description:</strong> ${assignment.description}</p>
                        <p><strong>Due Date:</strong> ${new Date(assignment.dueDate).toLocaleDateString()}</p>
                        <p><strong>Total Submissions:</strong> ${assignmentSubmissions.length}</p>
                    </div>

                    <div class="space-y-4">
                        ${assignmentSubmissions.length === 0 ? 
                            '<p class="text-gray-500">No submissions yet.</p>' :
                            assignmentSubmissions.map(submission => {
                                const student = users.find(u => u.id === submission.studentId);
                                const existingGrade = grades.find(g => g.assignmentId === assignmentId && g.studentId === submission.studentId);
                                
                                return `
                                    <div class="border border-gray-200 rounded-lg p-4">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <h4 class="font-bold">${student.name}</h4>
                                                <p class="text-sm text-gray-500">Submitted: ${new Date(submission.submittedAt).toLocaleDateString()}</p>
                                            </div>
                                            ${existingGrade ? 
                                                `<span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">Graded: ${existingGrade.score}/100</span>` :
                                                `<span class="bg-yellow-100 text-yellow-800 px-2 py-1 rounded text-sm">Pending</span>`
                                            }
                                        </div>
                                        
                                        <div class="bg-gray-50 p-3 rounded mb-3">
                                            <p class="text-sm font-medium mb-2">üìù Written Submission:</p>
                                            <p class="text-sm">${submission.content || 'No written content provided'}</p>
                                            ${submission.fileName ? `
                                                <div class="mt-3 p-2 bg-blue-50 rounded border-l-4 border-blue-400">
                                                    <p class="text-sm font-medium text-blue-800 mb-1">üìé Attached File:</p>
                                                    <div class="flex items-center justify-between">
                                                        <div class="text-xs text-blue-600">
                                                            <span class="font-medium">${submission.fileName}</span>
                                                            <span class="ml-2">(${submission.fileSize})</span>
                                                            <span class="ml-2">${submission.fileType}</span>
                                                        </div>
                                                        <button onclick="viewSubmissionFile('${submission.id}')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 transition-colors">
                                                            üëÅÔ∏è View File
                                                        </button>
                                                    </div>
                                                </div>
                                            ` : ''}
                                        </div>

                                        ${existingGrade ? 
                                            `<div class="bg-green-50 p-3 rounded">
                                                <p class="text-sm"><strong>Grade:</strong> ${existingGrade.score}/100</p>
                                                <p class="text-sm"><strong>Feedback:</strong> ${existingGrade.feedback || 'No feedback provided'}</p>
                                            </div>` :
                                            `<form onsubmit="gradeSubmission(event, '${assignmentId}', '${submission.studentId}')" class="space-y-3">
                                                <div class="flex space-x-3">
                                                    <input type="number" min="0" max="100" placeholder="Score (0-100)" required class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500" name="score">
                                                    <button type="submit" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 transition-colors">Grade</button>
                                                </div>
                                                <textarea placeholder="Feedback (optional)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 h-20" name="feedback"></textarea>
                                            </form>`
                                        }
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>
                </div>
            `;
        }

        function gradeSubmission(event, assignmentId, studentId) {
            event.preventDefault();
            
            const score = parseInt(event.target.score.value);
            const feedback = event.target.feedback.value;

            const newGrade = {
                id: generateId(),
                assignmentId,
                studentId,
                score,
                feedback,
                gradedAt: new Date().toISOString()
            };

            grades.push(newGrade);
            saveData();
            
            showNotification('Assignment graded successfully!');
            viewSubmissions(assignmentId); // Refresh the view
        }

        function viewStudentGrades(studentId, courseId) {
            const student = users.find(u => u.id === studentId);
            const courseAssignments = assignments.filter(a => a.courseId === courseId);
            const studentGrades = grades.filter(g => g.studentId === studentId && courseAssignments.some(a => a.id === g.assignmentId));
            
            document.getElementById('modalCourseTitle').textContent = `Grades: ${student.name}`;
            document.getElementById('courseContent').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-bold text-lg mb-2">Student Information</h3>
                        <p><strong>Name:</strong> ${student.name}</p>
                        <p><strong>Email:</strong> ${student.email}</p>
                    </div>

                    ${studentGrades.length === 0 ? 
                        '<p class="text-gray-500">No grades available for this student.</p>' :
                        `<div class="bg-white border border-gray-200 p-4 rounded-lg">
                            <h3 class="font-bold text-lg mb-4">Grade Summary</h3>
                            ${(() => {
                                const totalScore = studentGrades.reduce((sum, grade) => sum + grade.score, 0);
                                const averageScore = totalScore / studentGrades.length;
                                
                                return `
                                    <div class="mb-4 p-3 bg-indigo-50 rounded-lg">
                                        <p class="text-lg font-bold text-indigo-800">Overall Average: ${averageScore.toFixed(1)}/100</p>
                                    </div>
                                    <div class="space-y-3">
                                        ${studentGrades.map(grade => {
                                            const assignment = courseAssignments.find(a => a.id === grade.assignmentId);
                                            return `
                                                <div class="border border-gray-200 rounded-lg p-3">
                                                    <div class="flex justify-between items-center mb-2">
                                                        <h4 class="font-medium">${assignment.title}</h4>
                                                        <span class="text-lg font-bold ${grade.score >= 70 ? 'text-green-600' : grade.score >= 50 ? 'text-yellow-600' : 'text-red-600'}">${grade.score}/100</span>
                                                    </div>
                                                    ${grade.feedback ? `<p class="text-sm text-gray-600">${grade.feedback}</p>` : ''}
                                                    <p class="text-xs text-gray-500 mt-2">Graded: ${new Date(grade.gradedAt).toLocaleDateString()}</p>
                                                </div>
                                            `;
                                        }).join('')}
                                    </div>
                                `;
                            })()}
                        </div>`
                    }
                </div>
            `;
        }

        // Course Material Functions
        function uploadCourseMaterial(event, courseId) {
            event.preventDefault();
            
            const title = document.getElementById('materialTitle').value;
            const description = document.getElementById('materialDescription').value;
            const type = document.getElementById('materialType').value;
            const fileInput = document.getElementById('materialFile');
            
            if (!fileInput.files.length) {
                showNotification('Please select a file to upload!', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const newMaterial = {
                id: generateId(),
                courseId: courseId,
                title: title,
                description: description,
                type: type,
                fileName: file.name,
                fileSize: (file.size / 1024 / 1024).toFixed(2) + ' MB',
                fileType: file.type || 'Unknown',
                uploadedAt: new Date().toISOString(),
                uploadedBy: currentUser.id
            };
            
            courseMaterials.push(newMaterial);
            saveData();
            
            showNotification('Course material uploaded successfully!');
            
            // Clear form
            document.getElementById('materialTitle').value = '';
            document.getElementById('materialDescription').value = '';
            document.getElementById('materialType').value = '';
            document.getElementById('materialFile').value = '';
            
            // Refresh the course management view
            manageCourse(courseId);
        }

        function deleteMaterial(materialId, courseId) {
            const materialIndex = courseMaterials.findIndex(m => m.id === materialId);
            if (materialIndex > -1) {
                courseMaterials.splice(materialIndex, 1);
                saveData();
                showNotification('Material deleted successfully!');
                manageCourse(courseId);
            }
        }

        function downloadMaterial(materialId) {
            const material = courseMaterials.find(m => m.id === materialId);
            if (material) {
                showNotification(`Downloading ${material.fileName}... (Demo: File download would start in a real system)`);
            }
        }

        function viewSubmissionFile(submissionId) {
            const submission = submissions.find(s => s.id === submissionId);
            if (submission && submission.fileName) {
                showNotification(`Opening ${submission.fileName}... (Demo: File would open in a real system)`);
            }
        }

        function viewPendingSubmissions(assignmentId) {
            const assignment = assignments.find(a => a.id === assignmentId);
            const assignmentSubmissions = submissions.filter(s => s.assignmentId === assignmentId);
            const pendingSubmissions = assignmentSubmissions.filter(s => !grades.some(g => g.assignmentId === assignmentId && g.studentId === s.studentId));
            
            document.getElementById('modalCourseTitle').textContent = `‚è≥ Pending Grades: ${assignment.title}`;
            document.getElementById('courseContent').innerHTML = `
                <div class="space-y-4">
                    <div class="bg-orange-50 p-4 rounded-lg border-l-4 border-orange-400">
                        <h3 class="font-bold text-lg mb-2 text-orange-800">‚ö†Ô∏è Assignments Awaiting Grades</h3>
                        <p class="text-orange-700">These submissions need to be graded:</p>
                        <p class="text-sm text-orange-600 mt-1">${pendingSubmissions.length} submissions pending</p>
                    </div>

                    <div class="space-y-4">
                        ${pendingSubmissions.length === 0 ? 
                            '<p class="text-gray-500">All submissions have been graded!</p>' :
                            pendingSubmissions.map(submission => {
                                const student = users.find(u => u.id === submission.studentId);
                                
                                return `
                                    <div class="border-2 border-orange-200 rounded-lg p-4 bg-orange-50">
                                        <div class="flex justify-between items-start mb-3">
                                            <div>
                                                <h4 class="font-bold text-orange-800">${student.name}</h4>
                                                <p class="text-sm text-orange-600">Submitted: ${new Date(submission.submittedAt).toLocaleDateString()}</p>
                                            </div>
                                            <span class="bg-orange-200 text-orange-800 px-3 py-1 rounded-full text-sm font-medium">‚è≥ Needs Grading</span>
                                        </div>
                                        
                                        <div class="bg-white p-3 rounded mb-3 border">
                                            <p class="text-sm font-medium mb-2">üìù Written Submission:</p>
                                            <p class="text-sm">${submission.content || 'No written content provided'}</p>
                                            ${submission.fileName ? `
                                                <div class="mt-3 p-2 bg-blue-50 rounded border-l-4 border-blue-400">
                                                    <p class="text-sm font-medium text-blue-800 mb-1">üìé Attached File:</p>
                                                    <div class="flex items-center justify-between">
                                                        <div class="text-xs text-blue-600">
                                                            <span class="font-medium">${submission.fileName}</span>
                                                            <span class="ml-2">(${submission.fileSize})</span>
                                                        </div>
                                                        <button onclick="viewSubmissionFile('${submission.id}')" class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 transition-colors">
                                                            üëÅÔ∏è View File
                                                        </button>
                                                    </div>
                                                </div>
                                            ` : ''}
                                        </div>

                                        <form onsubmit="gradeSubmission(event, '${assignmentId}', '${submission.studentId}')" class="space-y-3 bg-white p-3 rounded border">
                                            <div class="flex space-x-3">
                                                <input type="number" min="0" max="100" placeholder="Score (0-100)" required class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500" name="score">
                                                <button type="submit" class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-2 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-300 font-semibold shadow-lg">‚úÖ Grade Now</button>
                                            </div>
                                            <textarea placeholder="Feedback (optional)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-indigo-500 h-20" name="feedback"></textarea>
                                        </form>
                                    </div>
                                `;
                            }).join('')
                        }
                    </div>
                </div>
            `;
        }

        // Close modal when clicking outside
        document.getElementById('courseModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeCourseModal();
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98f108c6c24fc508',t:'MTc2MDU0OTMyMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
